- name: Running containers on the server
  hosts: lune
  become: true

  tasks:
    - name: Copy Composefile
      copy:
        src: "{{ PROJECT_DIR }}/compose.yaml"
        dest: /home/lune/server/

    - name: Copy SSL
      copy:
        src: "{{ item }}"
        dest: /home/lune/server/ssl/
        follow: true
      with_fileglob:
        - "{{ PROJECT_DIR }}/images/nginx/ssl/*"

    - name: Copy Bash Script
      copy:
        src: "{{ PROJECT_DIR }}/infra/ansible/playbook/build/scripts/start.sh"
        dest: /home/lune/server/
        mode: "0755"
        owner: lune

    - name: Run start.sh
      ansible.builtin.command: "/home/lune/server/start.sh"
