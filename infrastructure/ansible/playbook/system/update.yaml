- name: Download system update
  hosts: lune
  become: true
  vars:
    default_retries: 2
    default_delay: 5
    reboot_timeout: 150
    wait_timeout: 600

  tasks:
    - name: Update System
      ansible.builtin.dnf:
        update_cache: true
        state: latest

    - name: Reboot
      ansible.builtin.reboot:
        reboot_timeout: "{{ reboot_timeout }}"
      register: reboot_result
      retries: "{{ default_retries }}"
      delay: "{{ default_delay }}"

    - name: Waiting for the server to come back
      ansible.builtin.wait_for:
        port: 22
        delay: "{{ default_delay }}"
        timeout: "{{ wait_timeout }}"
